{% extends 'portalteacher/base.html' %}
{% load staticfiles %}
{% load i18n %}
{% load crispy_forms_tags %}
{% block topcontent %}
<div class="row">
    <div class="col-lg-12">
        <h2 class="page-header">{% trans "About Me" %}</h2>
    </div>
    <!-- /.col-lg-12 -->
</div>
{% endblock topcontent %}
{% block botcontent %}
<div class="col-lg-12">
    <div class="panel panel-default">
        <div class="panel-heading">
        </div><br />
        <!-- /.panel-heading -->
        <div class="gentable" id ="admin-newtopic">
         <input type ="text" class="form-control" value="{{user.id}}"name="admin_id" id="admin_id" style='display:none;'>
          <!-- div id="file-uploader">File Uploader Comes Here...</div --> 
            {% crispy form %}
        </div>
        <div class="text-center">
            <div>&nbsp;</div>
            <button class="btn btn-primary" id="addrec">Save</button>
        </div>

        <!-- /.panel-body -->
    </div>
    <!-- /.panel -->
</div>
{% endblock botcontent%}

{% block morecss %}
<link href="{%static "css/plugins/dataTables.bootstrap.css" %}" rel="stylesheet">
<link href="{%static "bower_components/bootstrap3-dialog/dist/css/bootstrap-dialog.css" %}" rel="stylesheet">
<style>
    #addrec:hover, .tts-delete:hover{
        cursor: pointer;
    }
</style>
{% endblock morecss %}

{% block morescript %}
<script src="{%static "js/plugins/dataTables/jquery.dataTables.js" %}"></script>
<script src="{%static "js/plugins/dataTables/dataTables.bootstrap.js" %}"></script>
<script src="{% static "bower_components/bootstrap3-dialog/dist/js/bootstrap-dialog.js" %}"></script>
<script src="{% static "bower_components/jsrender/jsrender.min.js" %}"></script>
<script src="{% static "js/tts.utils.js" %}"></script>
{% endblock morescript %}

{% block scriptcontent %}

<script>
window.TTS = window.TTS || {}
TTS.forms = TTS.forms || {}

TTS.forms.showadminform = function() {
    BootstrapDialog.show({
        title: 'Add Administrator',
        message: $($('#admin-form').render()),
        onshown: function(){
            TTS.forms.upload();
        },
        buttons: [{
            label: '{% trans "Save" %}',
            cssClass: 'btn-primary',
            action: function(dialogItself){
                var data = TTS.utils.serilaizeJson("#add-admin");
                //console.log(data);
                TTS.forms.addadmin(dialogItself, data); 
            }
            },{
            label: '{% trans "Close" %}',
            action: function(dlg){
                dlg.close();
            }
        }]
    });
};

TTS.forms.upload = function(elm) {
    console.log(elm);
    var uploader = new qq.FileUploader({
        action: "/admin/admin-img-upload",
        element: $('#file-uploader')[0],
        multiple: false,
        onComplete: function(id, fileName, responseJSON) {
            if(responseJSON.success) {
                $("#id_image").val(responseJSON.path.replace('static/', ''));
            } else {
                alert("upload failed!");
            }
        },
        onAllComplete: function(uploads) {
            // the maps look like this: {file: FileObject, response: JSONServerResponse}
        },
        params: {
            'csrf_token': '{{ csrf_token }}',
            'csrf_name': 'csrfmiddlewaretoken',
            'csrf_xname': 'X-CSRFToken',
        },
    });
};

$(document).ready(function(){
    //var upload =  TTS.forms.upload();
   
   $.ajax({
        //"url":"/api/admin/logininfo/"+$("#admin_id").val()+"/?format=json",
        "url":"/api/admin/teacher/"+$("#admin_id").val()+"/?format=json",
        "type":"GET"
    }).done(function(data){
        $("#id_username").val(data.username); 
        $("#id_firstname").val(data.firstname);
        $("#id_emailid").val(data.emailid);
        $("#id_password").val(data.password);
        $("#admin_photo").val(data.imageurl);
        
    });

    $("#mybtn").click(function(){
        var data = {
            'username' : $("#admin_username").val(),
            'firstname'    : $("#admin_fname").val(),
            'password' : $("#input").val(),
            'emailid'    : $("#email").val(),
            'imageurl'    : $("#admin_photo").val(),
        }       
        var url="/api/admin/teacher/?username="+$("#admin_username").val()+"&format=json";
        $.ajax({
            headers : {
            'X-CSRFToken' : TTS.utils.getCookie('csrftoken')
            },
             type:'PUT',
            data: JSON.stringify(data),
            url:url
        }).done(function(data){
            TTS.forms.upload();
        }); 
    });
    $("#page-wrapper").on("click", "#addrec", function(){
        TTS.forms.showadminform();
    });
    
});

</script>
{% endblock scriptcontent %}