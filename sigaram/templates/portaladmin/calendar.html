{% extends 'portaladmin/base.html' %}
{% load i18n %}
{% load staticfiles %}
{% block topcontent %}
        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h2 class="page-header">Calendar </h2>
                </div>
                <!-- /.col-lg-12 -->
            </div>
{% endblock topcontent %}
{% block botcontent %}
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                             Calendar
                        </div>
                        <!-- /.panel-heading -->
                        <div id='calendar'></div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-12 -->
{% endblock botcontent%}

{% block morescript %}
<script src="{%static "bower_components/moment/min/moment.min.js" %}"></script>
<script src="{%static "bower_components/fullcalendar/dist/fullcalendar.js" %}"></script>
{% endblock morescript %}

{% block scriptcontent %}
<script>
    
    function saveMyData(event) {
        var data = {
            "title" : event.title,
            "start" : event.start.format()+'T00:00Z',
            "end" : event.end.format()+'T00:00Z'
        };
        $.ajax({
            type:'POST',
            data: data,
            url : '/api/admin/calendar/'
        }).done(function( msg ) {
            alert(msg)
        });
    }

	$(document).ready(function() {
        var calendar = $('#calendar').fullCalendar({
            selectable: true,
            selectHelper: true,
            header:
            {
                left: 'prev,next today',
                center: 'title',
                right: 'month,agendaWeek,agendaDay'
            },
            select: function(start, end, allDay)
            {
                var title = prompt('Event Title:');
                if (title)
                {
                    calendar.fullCalendar('renderEvent',
                        {
                            title: title,
                            start: start,
                            end: end,
                            allDay : allDay
                            //start_time : start.getTime() / 1000,
                            //end_time : end.getTime() / 1000,
                        },
                        true // make the event "stick"
                    );
                
                calendar.fullCalendar('unselect');
                saveMyData({'title': title, 
                            'start': start, 
                            'end': end
                        });
                }
            },
            eventDrop: function (event, dayDelta, minuteDelta) {
                saveMyData(event);
            },

            eventResize: function (event, dayDelta, minuteDelta) {
                saveMyData(event);
             },
            editable: true,
            events: {
                url:'/api/admin/calendar/'
            },
	    })
	});
</script>
{% endblock scriptcontent %}

{% block morecss %}
<link rel="stylesheet" href="{%static "bower_components/fullcalendar/dist/fullcalendar.min.css" %}">
{% endblock morecss %}
